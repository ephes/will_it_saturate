---

title: Benchmark Over Network


keywords: fastai
sidebar: home_sidebar



nb_path: "51_benchmark_remote_control_server.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 51_benchmark_remote_control_server.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">httpx</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urljoin</span>

<span class="kn">from</span> <span class="nn">will_it_saturate</span> <span class="kn">import</span> <span class="n">servers</span>
<span class="kn">from</span> <span class="nn">will_it_saturate</span> <span class="kn">import</span> <span class="n">clients</span>
<span class="kn">from</span> <span class="nn">will_it_saturate.epochs</span> <span class="kn">import</span> <span class="n">Epoch</span>
<span class="kn">from</span> <span class="nn">will_it_saturate.hosts</span> <span class="kn">import</span> <span class="n">Host</span><span class="p">,</span> <span class="n">HostDetails</span>

<span class="kn">from</span> <span class="nn">will_it_saturate.results</span> <span class="kn">import</span> <span class="n">Result</span>
<span class="kn">from</span> <span class="nn">will_it_saturate.files</span> <span class="kn">import</span> <span class="n">BenchmarkFile</span>
<span class="kn">from</span> <span class="nn">will_it_saturate.control.client</span> <span class="kn">import</span> <span class="n">ControlClient</span>
<span class="kn">from</span> <span class="nn">will_it_saturate.repositories</span> <span class="kn">import</span> <span class="n">SqliteRepository</span><span class="p">,</span> <span class="n">register_default_tables</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="393aa648-6f43-439e-9be8-03be8c7cdee8"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#393aa648-6f43-439e-9be8-03be8c7cdee8');

            setTimeout(function() {
                var nbb_cell_id = 2;
                var nbb_unformatted_code = "import httpx\nimport pandas as pd\n\nfrom urllib.parse import urljoin\n\nfrom will_it_saturate import servers\nfrom will_it_saturate import clients\nfrom will_it_saturate.epochs import Epoch\nfrom will_it_saturate.hosts import Host, HostDetails\n\nfrom will_it_saturate.results import Result\nfrom will_it_saturate.files import BenchmarkFile\nfrom will_it_saturate.control.client import ControlClient\nfrom will_it_saturate.repositories import SqliteRepository, register_default_tables";
                var nbb_formatted_code = "import httpx\nimport pandas as pd\n\nfrom urllib.parse import urljoin\n\nfrom will_it_saturate import servers\nfrom will_it_saturate import clients\nfrom will_it_saturate.epochs import Epoch\nfrom will_it_saturate.hosts import Host, HostDetails\n\nfrom will_it_saturate.results import Result\nfrom will_it_saturate.files import BenchmarkFile\nfrom will_it_saturate.control.client import ControlClient\nfrom will_it_saturate.repositories import SqliteRepository, register_default_tables";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-Benchmark-Server">Create Benchmark Server<a class="anchor-link" href="#Create-Benchmark-Server"> </a></h2><p>create server control client + server (needed for turning files into urls)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">server_control_host</span> <span class="o">=</span> <span class="n">Host</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;macmini.fritz.box&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8001</span><span class="p">)</span>
<span class="n">server_control_client</span> <span class="o">=</span> <span class="n">ControlClient</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">server_control_host</span><span class="p">)</span>
<span class="n">server_details</span> <span class="o">=</span> <span class="n">server_control_client</span><span class="o">.</span><span class="n">get_host_details</span><span class="p">()</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">server_control_client</span><span class="o">.</span><span class="n">get_or_create_server</span><span class="p">(</span>
    <span class="n">servers</span><span class="o">.</span><span class="n">FastAPIUvicornServer</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;macmini.fritz.box&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5001</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="8ae70ebb-47f0-4f34-acf7-5a0e64f27bfc"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#8ae70ebb-47f0-4f34-acf7-5a0e64f27bfc');

            setTimeout(function() {
                var nbb_cell_id = 3;
                var nbb_unformatted_code = "# dont_test\n\nserver_control_host = Host(name=\"macmini.fritz.box\", port=8001)\nserver_control_client = ControlClient(host=server_control_host)\nserver_details = server_control_client.get_host_details()\nserver = server_control_client.get_or_create_server(servers.FastAPIUvicornServer(host=\"macmini.fritz.box\", port=5001))";
                var nbb_formatted_code = "# dont_test\n\nserver_control_host = Host(name=\"macmini.fritz.box\", port=8001)\nserver_control_client = ControlClient(host=server_control_host)\nserver_details = server_control_client.get_host_details()\nserver = server_control_client.get_or_create_server(\n    servers.FastAPIUvicornServer(host=\"macmini.fritz.box\", port=5001)\n)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-Files-and-Urls">Create Files and Urls<a class="anchor-link" href="#Create-Files-and-Urls"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">byte</span><span class="p">,</span> <span class="n">file_size</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span>
<span class="n">epoch</span> <span class="o">=</span> <span class="n">Epoch</span><span class="p">(</span><span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">server_control_client</span><span class="o">.</span><span class="n">get_or_create_files</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
<span class="n">epoch</span><span class="o">.</span><span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">server</span><span class="o">.</span><span class="n">file_to_url</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="44889e80-5146-4e04-bd8e-6b7578e644f1"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#44889e80-5146-4e04-bd8e-6b7578e644f1');

            setTimeout(function() {
                var nbb_cell_id = 4;
                var nbb_unformatted_code = "# dont_test\n\nbyte, file_size, duration = 8, 10 ** 7, 3\nepoch = Epoch(file_size=file_size, duration=duration)\nfiles = server_control_client.get_or_create_files(epoch)\nepoch.urls = [server.file_to_url(file) for file in files]";
                var nbb_formatted_code = "# dont_test\n\nbyte, file_size, duration = 8, 10 ** 7, 3\nepoch = Epoch(file_size=file_size, duration=duration)\nfiles = server_control_client.get_or_create_files(epoch)\nepoch.urls = [server.file_to_url(file) for file in files]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-Control-Client">Create Control Client<a class="anchor-link" href="#Create-Control-Client"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">client_control_host</span> <span class="o">=</span> <span class="n">Host</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8001</span><span class="p">)</span>
<span class="n">client_control_client</span> <span class="o">=</span> <span class="n">ControlClient</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">client_control_host</span><span class="p">)</span>
<span class="n">client_details</span> <span class="o">=</span> <span class="n">client_control_client</span><span class="o">.</span><span class="n">get_host_details</span><span class="p">()</span>
<span class="n">benchmark_client</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">HttpxClient</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;httpx&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="c98cee7c-c686-4b53-8f9b-256ccf81bf2c"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#c98cee7c-c686-4b53-8f9b-256ccf81bf2c');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "# dont_test\n\nclient_control_host = Host(name=\"localhost\", port=8001)\nclient_control_client = ControlClient(host=client_control_host)\nclient_details = client_control_client.get_host_details()\nbenchmark_client = clients.HttpxClient(name=\"httpx\")";
                var nbb_formatted_code = "# dont_test\n\nclient_control_host = Host(name=\"localhost\", port=8001)\nclient_control_client = ControlClient(host=client_control_host)\nclient_details = client_control_client.get_host_details()\nbenchmark_client = clients.HttpxClient(name=\"httpx\")";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-Result">Create Result<a class="anchor-link" href="#Create-Result"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
    <span class="n">server</span><span class="o">=</span><span class="n">server</span><span class="p">,</span>
    <span class="n">client</span><span class="o">=</span><span class="n">benchmark_client</span><span class="p">,</span>
    <span class="n">server_details</span><span class="o">=</span><span class="n">server_details</span><span class="p">,</span>
    <span class="n">client_details</span><span class="o">=</span><span class="n">client_details</span><span class="p">,</span>
    <span class="n">file_size</span><span class="o">=</span><span class="n">epoch</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span>
    <span class="n">complete_size</span><span class="o">=</span><span class="n">epoch</span><span class="o">.</span><span class="n">complete_size</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="821aea41-1004-46f5-ae5e-6c59d4a02d03"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#821aea41-1004-46f5-ae5e-6c59d4a02d03');

            setTimeout(function() {
                var nbb_cell_id = 6;
                var nbb_unformatted_code = "# dont_test\n\nresult = Result(\n    server=server,\n    client=benchmark_client,\n    server_details=server_details,\n    client_details=client_details,\n    file_size=epoch.file_size,\n    complete_size=epoch.complete_size,\n)";
                var nbb_formatted_code = "# dont_test\n\nresult = Result(\n    server=server,\n    client=benchmark_client,\n    server_details=server_details,\n    client_details=client_details,\n    file_size=epoch.file_size,\n    complete_size=epoch.complete_size,\n)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;http://macmini.fritz.box:5001/data/10000000_3_125000000/0&#39;,
 &#39;http://macmini.fritz.box:5001/data/10000000_3_125000000/1&#39;,
 &#39;http://macmini.fritz.box:5001/data/10000000_3_125000000/2&#39;,
 &#39;http://macmini.fritz.box:5001/data/10000000_3_125000000/3&#39;,
 &#39;http://macmini.fritz.box:5001/data/10000000_3_125000000/4&#39;]</pre>
</div>

</div>

<div class="output_area">




<div id="3c219671-fe02-424f-8a84-fa3b54103e6c"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#3c219671-fe02-424f-8a84-fa3b54103e6c');

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "epoch.urls[:5]";
                var nbb_formatted_code = "epoch.urls[:5]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># r = httpx.get(&quot;http://macmini.fritz.box:5001/data/10000000_3_125000000/0&quot;)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="f8c52bbb-45d3-43a8-9663-e9005f348526"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#f8c52bbb-45d3-43a8-9663-e9005f348526');

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "import httpx\n\n\nr = httpx.get(\"http://macmini.fritz.box:5001/data/10000000_3_125000000/0\")";
                var nbb_formatted_code = "import httpx\n\n\nr = httpx.get(\"http://macmini.fritz.box:5001/data/10000000_3_125000000/0\")";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Measure-Server-with-Client">Measure Server with Client<a class="anchor-link" href="#Measure-Server-with-Client"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="n">client_control_client</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">benchmark_client</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-8-feaa15c2887b&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-fg"># dont_test</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> 
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> </span>result<span class="ansi-blue-fg">.</span>elapsed <span class="ansi-blue-fg">=</span> client_control_client<span class="ansi-blue-fg">.</span>measure<span class="ansi-blue-fg">(</span>benchmark_client<span class="ansi-blue-fg">,</span> epoch<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/projects/will_it_saturate/will_it_saturate/control/client.py</span> in <span class="ansi-cyan-fg">measure</span><span class="ansi-blue-fg">(self, client, epoch)</span>
<span class="ansi-green-intense-fg ansi-bold">     43</span>         url <span class="ansi-blue-fg">=</span> urljoin<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>base_url<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#34;measure&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     44</span>         data <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">&#34;client_params&#34;</span><span class="ansi-blue-fg">:</span> client<span class="ansi-blue-fg">.</span>params<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#34;epoch&#34;</span><span class="ansi-blue-fg">:</span> epoch<span class="ansi-blue-fg">.</span>dict<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">}</span>
<span class="ansi-green-fg">---&gt; 45</span><span class="ansi-red-fg">         </span>r <span class="ansi-blue-fg">=</span> httpx<span class="ansi-blue-fg">.</span>post<span class="ansi-blue-fg">(</span>url<span class="ansi-blue-fg">,</span> json<span class="ansi-blue-fg">=</span>data<span class="ansi-blue-fg">,</span> timeout<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     46</span>         r<span class="ansi-blue-fg">.</span>raise_for_status<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     47</span>         <span class="ansi-green-fg">return</span> r<span class="ansi-blue-fg">.</span>json<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/.virtualenvs/wis/lib/python3.9/site-packages/httpx/_api.py</span> in <span class="ansi-cyan-fg">post</span><span class="ansi-blue-fg">(url, content, data, files, json, params, headers, cookies, auth, proxies, allow_redirects, cert, verify, timeout, trust_env)</span>
<span class="ansi-green-intense-fg ansi-bold">    294</span>     <span class="ansi-blue-fg">**</span>Parameters<span class="ansi-blue-fg">**</span><span class="ansi-blue-fg">:</span> See<span class="ansi-red-fg"> </span><span class="ansi-red-fg">`</span>httpx<span class="ansi-blue-fg">.</span>request<span class="ansi-red-fg">`</span><span class="ansi-blue-fg">.</span>
<span class="ansi-green-intense-fg ansi-bold">    295</span>     &#34;&#34;&#34;
<span class="ansi-green-fg">--&gt; 296</span><span class="ansi-red-fg">     return request(
</span><span class="ansi-green-intense-fg ansi-bold">    297</span>         <span class="ansi-blue-fg">&#34;POST&#34;</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    298</span>         url<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/.virtualenvs/wis/lib/python3.9/site-packages/httpx/_api.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(method, url, params, content, data, files, json, headers, cookies, auth, proxies, timeout, allow_redirects, verify, cert, trust_env)</span>
<span class="ansi-green-intense-fg ansi-bold">     91</span>         proxies<span class="ansi-blue-fg">=</span>proxies<span class="ansi-blue-fg">,</span> cert<span class="ansi-blue-fg">=</span>cert<span class="ansi-blue-fg">,</span> verify<span class="ansi-blue-fg">=</span>verify<span class="ansi-blue-fg">,</span> timeout<span class="ansi-blue-fg">=</span>timeout<span class="ansi-blue-fg">,</span> trust_env<span class="ansi-blue-fg">=</span>trust_env
<span class="ansi-green-intense-fg ansi-bold">     92</span>     ) as client:
<span class="ansi-green-fg">---&gt; 93</span><span class="ansi-red-fg">         return client.request(
</span><span class="ansi-green-intense-fg ansi-bold">     94</span>             method<span class="ansi-blue-fg">=</span>method<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     95</span>             url<span class="ansi-blue-fg">=</span>url<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/.virtualenvs/wis/lib/python3.9/site-packages/httpx/_client.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, content, data, files, json, params, headers, cookies, auth, allow_redirects, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    726</span>             cookies<span class="ansi-blue-fg">=</span>cookies<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    727</span>         )
<span class="ansi-green-fg">--&gt; 728</span><span class="ansi-red-fg">         return self.send(
</span><span class="ansi-green-intense-fg ansi-bold">    729</span>             request<span class="ansi-blue-fg">,</span> auth<span class="ansi-blue-fg">=</span>auth<span class="ansi-blue-fg">,</span> allow_redirects<span class="ansi-blue-fg">=</span>allow_redirects<span class="ansi-blue-fg">,</span> timeout<span class="ansi-blue-fg">=</span>timeout
<span class="ansi-green-intense-fg ansi-bold">    730</span>         )

<span class="ansi-green-fg">~/.virtualenvs/wis/lib/python3.9/site-packages/httpx/_client.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, stream, auth, allow_redirects, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    760</span>         auth <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_build_request_auth<span class="ansi-blue-fg">(</span>request<span class="ansi-blue-fg">,</span> auth<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    761</span> 
<span class="ansi-green-fg">--&gt; 762</span><span class="ansi-red-fg">         response = self._send_handling_auth(
</span><span class="ansi-green-intense-fg ansi-bold">    763</span>             request<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    764</span>             auth<span class="ansi-blue-fg">=</span>auth<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/.virtualenvs/wis/lib/python3.9/site-packages/httpx/_client.py</span> in <span class="ansi-cyan-fg">_send_handling_auth</span><span class="ansi-blue-fg">(self, request, auth, timeout, allow_redirects, history)</span>
<span class="ansi-green-intense-fg ansi-bold">    798</span> 
<span class="ansi-green-intense-fg ansi-bold">    799</span>         <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 800</span><span class="ansi-red-fg">             response = self._send_handling_redirects(
</span><span class="ansi-green-intense-fg ansi-bold">    801</span>                 request<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    802</span>                 timeout<span class="ansi-blue-fg">=</span>timeout<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/.virtualenvs/wis/lib/python3.9/site-packages/httpx/_client.py</span> in <span class="ansi-cyan-fg">_send_handling_redirects</span><span class="ansi-blue-fg">(self, request, timeout, allow_redirects, history)</span>
<span class="ansi-green-intense-fg ansi-bold">    830</span>                 )
<span class="ansi-green-intense-fg ansi-bold">    831</span> 
<span class="ansi-green-fg">--&gt; 832</span><span class="ansi-red-fg">             </span>response <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_send_single_request<span class="ansi-blue-fg">(</span>request<span class="ansi-blue-fg">,</span> timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    833</span>             response<span class="ansi-blue-fg">.</span>history <span class="ansi-blue-fg">=</span> list<span class="ansi-blue-fg">(</span>history<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    834</span> 

<span class="ansi-green-fg">~/.virtualenvs/wis/lib/python3.9/site-packages/httpx/_client.py</span> in <span class="ansi-cyan-fg">_send_single_request</span><span class="ansi-blue-fg">(self, request, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    854</span> 
<span class="ansi-green-intense-fg ansi-bold">    855</span>         <span class="ansi-green-fg">with</span> map_exceptions<span class="ansi-blue-fg">(</span>HTTPCORE_EXC_MAP<span class="ansi-blue-fg">,</span> request<span class="ansi-blue-fg">=</span>request<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 856</span><span class="ansi-red-fg">             (status_code, headers, stream, ext) = transport.request(
</span><span class="ansi-green-intense-fg ansi-bold">    857</span>                 request<span class="ansi-blue-fg">.</span>method<span class="ansi-blue-fg">.</span>encode<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    858</span>                 request<span class="ansi-blue-fg">.</span>url<span class="ansi-blue-fg">.</span>raw<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/.virtualenvs/wis/lib/python3.9/site-packages/httpx/_transports/default.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, headers, stream, ext)</span>
<span class="ansi-green-intense-fg ansi-bold">    100</span>         ext<span class="ansi-blue-fg">:</span> dict <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    101</span>     ) -&gt; typing.Tuple[int, Headers, httpcore.SyncByteStream, dict]:
<span class="ansi-green-fg">--&gt; 102</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_pool<span class="ansi-blue-fg">.</span>request<span class="ansi-blue-fg">(</span>method<span class="ansi-blue-fg">,</span> url<span class="ansi-blue-fg">,</span> headers<span class="ansi-blue-fg">=</span>headers<span class="ansi-blue-fg">,</span> stream<span class="ansi-blue-fg">=</span>stream<span class="ansi-blue-fg">,</span> ext<span class="ansi-blue-fg">=</span>ext<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    103</span> 
<span class="ansi-green-intense-fg ansi-bold">    104</span>     <span class="ansi-green-fg">def</span> close<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.virtualenvs/wis/lib/python3.9/site-packages/httpcore/_sync/connection_pool.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, headers, stream, ext)</span>
<span class="ansi-green-intense-fg ansi-bold">    216</span> 
<span class="ansi-green-intense-fg ansi-bold">    217</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 218</span><span class="ansi-red-fg">                 response = connection.request(
</span><span class="ansi-green-intense-fg ansi-bold">    219</span>                     method<span class="ansi-blue-fg">,</span> url<span class="ansi-blue-fg">,</span> headers<span class="ansi-blue-fg">=</span>headers<span class="ansi-blue-fg">,</span> stream<span class="ansi-blue-fg">=</span>stream<span class="ansi-blue-fg">,</span> ext<span class="ansi-blue-fg">=</span>ext
<span class="ansi-green-intense-fg ansi-bold">    220</span>                 )

<span class="ansi-green-fg">~/.virtualenvs/wis/lib/python3.9/site-packages/httpcore/_sync/connection.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, headers, stream, ext)</span>
<span class="ansi-green-intense-fg ansi-bold">    104</span>             <span class="ansi-blue-fg">&#34;connection.request method=%r url=%r headers=%r&#34;</span><span class="ansi-blue-fg">,</span> method<span class="ansi-blue-fg">,</span> url<span class="ansi-blue-fg">,</span> headers
<span class="ansi-green-intense-fg ansi-bold">    105</span>         )
<span class="ansi-green-fg">--&gt; 106</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>connection<span class="ansi-blue-fg">.</span>request<span class="ansi-blue-fg">(</span>method<span class="ansi-blue-fg">,</span> url<span class="ansi-blue-fg">,</span> headers<span class="ansi-blue-fg">,</span> stream<span class="ansi-blue-fg">,</span> ext<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    107</span> 
<span class="ansi-green-intense-fg ansi-bold">    108</span>     <span class="ansi-green-fg">def</span> _open_socket<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> timeout<span class="ansi-blue-fg">:</span> TimeoutDict <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> SyncSocketStream<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.virtualenvs/wis/lib/python3.9/site-packages/httpcore/_sync/http11.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, headers, stream, ext)</span>
<span class="ansi-green-intense-fg ansi-bold">     70</span>             reason_phrase<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     71</span>             headers<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">---&gt; 72</span><span class="ansi-red-fg">         ) = self._receive_response(timeout)
</span><span class="ansi-green-intense-fg ansi-bold">     73</span>         response_stream = IteratorByteStream(
<span class="ansi-green-intense-fg ansi-bold">     74</span>             iterator<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>_receive_response_data<span class="ansi-blue-fg">(</span>timeout<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/.virtualenvs/wis/lib/python3.9/site-packages/httpcore/_sync/http11.py</span> in <span class="ansi-cyan-fg">_receive_response</span><span class="ansi-blue-fg">(self, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    131</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    132</span>         <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 133</span><span class="ansi-red-fg">             </span>event <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_receive_event<span class="ansi-blue-fg">(</span>timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    134</span>             <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>event<span class="ansi-blue-fg">,</span> h11<span class="ansi-blue-fg">.</span>Response<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    135</span>                 <span class="ansi-green-fg">break</span>

<span class="ansi-green-fg">~/.virtualenvs/wis/lib/python3.9/site-packages/httpcore/_sync/http11.py</span> in <span class="ansi-cyan-fg">_receive_event</span><span class="ansi-blue-fg">(self, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    170</span> 
<span class="ansi-green-intense-fg ansi-bold">    171</span>             <span class="ansi-green-fg">if</span> event <span class="ansi-green-fg">is</span> h11<span class="ansi-blue-fg">.</span>NEED_DATA<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 172</span><span class="ansi-red-fg">                 </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>socket<span class="ansi-blue-fg">.</span>read<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>READ_NUM_BYTES<span class="ansi-blue-fg">,</span> timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    173</span>                 self<span class="ansi-blue-fg">.</span>h11_state<span class="ansi-blue-fg">.</span>receive_data<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    174</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.virtualenvs/wis/lib/python3.9/site-packages/httpcore/_backends/sync.py</span> in <span class="ansi-cyan-fg">read</span><span class="ansi-blue-fg">(self, n, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">     60</span>             <span class="ansi-green-fg">with</span> map_exceptions<span class="ansi-blue-fg">(</span>exc_map<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     61</span>                 self<span class="ansi-blue-fg">.</span>sock<span class="ansi-blue-fg">.</span>settimeout<span class="ansi-blue-fg">(</span>read_timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 62</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>sock<span class="ansi-blue-fg">.</span>recv<span class="ansi-blue-fg">(</span>n<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     63</span> 
<span class="ansi-green-intense-fg ansi-bold">     64</span>     <span class="ansi-green-fg">def</span> write<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> data<span class="ansi-blue-fg">:</span> bytes<span class="ansi-blue-fg">,</span> timeout<span class="ansi-blue-fg">:</span> TimeoutDict<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>

<div class="output_area">




<div id="2ddafb11-4bab-4c2d-a7b7-d90b9e14feda"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#2ddafb11-4bab-4c2d-a7b7-d90b9e14feda');

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "# dont_test\n\nresult.elapsed = client_control_client.measure(benchmark_client, epoch)";
                var nbb_formatted_code = "# dont_test\n\nresult.elapsed = client_control_client.measure(benchmark_client, epoch)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># create server control client + server (needed for turning files into urls)</span>
<span class="n">server_control_host</span> <span class="o">=</span> <span class="n">Host</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;macmini.fritz.box&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8001</span><span class="p">)</span>
<span class="n">server_control_client</span> <span class="o">=</span> <span class="n">ControlClient</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">server_control_host</span><span class="p">)</span>
<span class="n">server_details</span> <span class="o">=</span> <span class="n">server_control_client</span><span class="o">.</span><span class="n">get_host_details</span><span class="p">()</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">server_control_client</span><span class="o">.</span><span class="n">get_or_create_server</span><span class="p">(</span><span class="n">FastAPIUvicornServer</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;macmini.&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>

<span class="c1"># create files and urls</span>
<span class="n">byte</span><span class="p">,</span> <span class="n">file_size</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span>
<span class="n">epoch</span> <span class="o">=</span> <span class="n">Epoch</span><span class="p">(</span><span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">server_control_client</span><span class="o">.</span><span class="n">get_or_create_files</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">files</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
<span class="n">epoch</span><span class="o">.</span><span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">server</span><span class="o">.</span><span class="n">file_to_url</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>

<span class="c1"># create control client + measure server</span>
<span class="n">client_control_host</span> <span class="o">=</span> <span class="n">Host</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8001</span><span class="p">)</span>
<span class="n">client_control_client</span> <span class="o">=</span> <span class="n">ControlClient</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">client_control_host</span><span class="p">)</span>
<span class="n">client_details</span> <span class="o">=</span> <span class="n">client_control_client</span><span class="o">.</span><span class="n">get_host_details</span><span class="p">()</span>
<span class="n">benchmark_client</span> <span class="o">=</span> <span class="n">HttpxClient</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;httpx&quot;</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
    <span class="n">server</span><span class="o">=</span><span class="n">server</span><span class="p">,</span>
    <span class="n">client</span><span class="o">=</span><span class="n">benchmark_client</span><span class="p">,</span>
    <span class="n">server_details</span><span class="o">=</span><span class="n">server_details</span><span class="p">,</span>
    <span class="n">client_details</span><span class="o">=</span><span class="n">client_details</span><span class="p">,</span>
    <span class="n">file_size</span><span class="o">=</span><span class="n">epoch</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span>
    <span class="n">complete_size</span><span class="o">=</span><span class="n">epoch</span><span class="o">.</span><span class="n">complete_size</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>protocol=&#39;http&#39; name=&#39;fastAPI/uvicorn&#39; host=&#39;localhost&#39; port=5001
[BenchmarkFile(number=0, base_path=&#39;10000000_3_125000000&#39;, size=10000000, data_root=&#39;data&#39;, hostname=&#39;localhost&#39;, port=8000, checksum=&#39;d41d8cd98f00b204e9800998ecf8427e&#39;, creator_name=&#39;filesystem&#39;), BenchmarkFile(number=1, base_path=&#39;10000000_3_125000000&#39;, size=10000000, data_root=&#39;data&#39;, hostname=&#39;localhost&#39;, port=8000, checksum=&#39;c2b87744cfbdf5a1bb0c3b691ca40e66&#39;, creator_name=&#39;filesystem&#39;), BenchmarkFile(number=2, base_path=&#39;10000000_3_125000000&#39;, size=10000000, data_root=&#39;data&#39;, hostname=&#39;localhost&#39;, port=8000, checksum=&#39;b197317f87369090fe0ae4bbfe90ddf3&#39;, creator_name=&#39;filesystem&#39;), BenchmarkFile(number=3, base_path=&#39;10000000_3_125000000&#39;, size=10000000, data_root=&#39;data&#39;, hostname=&#39;localhost&#39;, port=8000, checksum=&#39;0830427b0a6a8e5831fafa2babef13c1&#39;, creator_name=&#39;filesystem&#39;), BenchmarkFile(number=4, base_path=&#39;10000000_3_125000000&#39;, size=10000000, data_root=&#39;data&#39;, hostname=&#39;localhost&#39;, port=8000, checksum=&#39;46d44b3d9b086e224f1abb4133ab15ec&#39;, creator_name=&#39;filesystem&#39;), BenchmarkFile(number=5, base_path=&#39;10000000_3_125000000&#39;, size=10000000, data_root=&#39;data&#39;, hostname=&#39;localhost&#39;, port=8000, checksum=&#39;459c9b7f167385cd061dcef9dc20a8d2&#39;, creator_name=&#39;filesystem&#39;), BenchmarkFile(number=6, base_path=&#39;10000000_3_125000000&#39;, size=10000000, data_root=&#39;data&#39;, hostname=&#39;localhost&#39;, port=8000, checksum=&#39;5623f8aec6dbe2693f19d9e240dd6cc7&#39;, creator_name=&#39;filesystem&#39;), BenchmarkFile(number=7, base_path=&#39;10000000_3_125000000&#39;, size=10000000, data_root=&#39;data&#39;, hostname=&#39;localhost&#39;, port=8000, checksum=&#39;a888ed854c5e311da29873670ecbed41&#39;, creator_name=&#39;filesystem&#39;), BenchmarkFile(number=8, base_path=&#39;10000000_3_125000000&#39;, size=10000000, data_root=&#39;data&#39;, hostname=&#39;localhost&#39;, port=8000, checksum=&#39;6a35fe2cc7ac40a8951216fe4098b11f&#39;, creator_name=&#39;filesystem&#39;), BenchmarkFile(number=9, base_path=&#39;10000000_3_125000000&#39;, size=10000000, data_root=&#39;data&#39;, hostname=&#39;localhost&#39;, port=8000, checksum=&#39;f69faca1a12e612029ca29ed6ed069d0&#39;, creator_name=&#39;filesystem&#39;)]
</pre>
</div>
</div>

<div class="output_area">




<div id="f78b2fa1-dc12-4d9a-87a7-bc089ff8fc8f"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#f78b2fa1-dc12-4d9a-87a7-bc089ff8fc8f');

            setTimeout(function() {
                var nbb_cell_id = 3;
                var nbb_unformatted_code = "# dont_test\n\n# create server control client + server (needed for turning files into urls)\nserver_control_host = Host(name=\"macmini.fritz.box\", port=8001)\nserver_control_client = ControlClient(host=server_control_host)\nserver_details = server_control_client.get_host_details()\nserver = server_control_client.get_or_create_server(FastAPIUvicornServer())\nprint(server)\n\n# create files and urls\nbyte, file_size, duration = 8, 10 ** 7, 3\nepoch = Epoch(file_size=file_size, duration=duration)\nfiles = server_control_client.get_or_create_files(epoch)\nprint(files[:10])\nepoch.urls = [server.file_to_url(file) for file in files]\n\n# create control client + measure server\nclient_control_host = Host(name=\"localhost\", port=8001)\nclient_control_client = ControlClient(host=client_control_host)\nclient_details = client_control_client.get_host_details()\nbenchmark_client = HttpxClient(name=\"httpx\")\nclient_params = ClientParameters(**benchmark_client.params())\n\n\nresult = Result(\n    server=server,\n    client=benchmark_client,\n    server_details=server_details,\n    client_details=client_details,\n    file_size=epoch.file_size,\n    complete_size=epoch.complete_size,\n)";
                var nbb_formatted_code = "# dont_test\n\n# create server control client + server (needed for turning files into urls)\nserver_control_host = Host(name=\"macmini.fritz.box\", port=8001)\nserver_control_client = ControlClient(host=server_control_host)\nserver_details = server_control_client.get_host_details()\nserver = server_control_client.get_or_create_server(FastAPIUvicornServer())\nprint(server)\n\n# create files and urls\nbyte, file_size, duration = 8, 10 ** 7, 3\nepoch = Epoch(file_size=file_size, duration=duration)\nfiles = server_control_client.get_or_create_files(epoch)\nprint(files[:10])\nepoch.urls = [server.file_to_url(file) for file in files]\n\n# create control client + measure server\nclient_control_host = Host(name=\"localhost\", port=8001)\nclient_control_client = ControlClient(host=client_control_host)\nclient_details = client_control_client.get_host_details()\nbenchmark_client = HttpxClient(name=\"httpx\")\nclient_params = ClientParameters(**benchmark_client.params())\n\n\nresult = Result(\n    server=server,\n    client=benchmark_client,\n    server_details=server_details,\n    client_details=client_details,\n    file_size=epoch.file_size,\n    complete_size=epoch.complete_size,\n)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="n">client_control_client</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">benchmark_client</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">elapsed</span><span class="p">)</span>

<span class="c1"># result.elapsed = benchmark_client.measure(epoch)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>3.159423792
</pre>
</div>
</div>

<div class="output_area">




<div id="58931e75-f44d-4fbc-ba41-33cc81e7485a"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#58931e75-f44d-4fbc-ba41-33cc81e7485a');

            setTimeout(function() {
                var nbb_cell_id = 6;
                var nbb_unformatted_code = "# dont_test\n\nresult.elapsed = client_control_client.measure(client_params, epoch)\nprint(result.elapsed)\n\n# result.elapsed = benchmark_client.measure(epoch)";
                var nbb_formatted_code = "# dont_test\n\nresult.elapsed = client_control_client.measure(client_params, epoch)\nprint(result.elapsed)\n\n# result.elapsed = benchmark_client.measure(epoch)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">bytes_per_second</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>118850051.28710909</pre>
</div>

</div>

<div class="output_area">




<div id="052f96e3-a1de-4db4-9216-05e0b11aacff"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#052f96e3-a1de-4db4-9216-05e0b11aacff');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "# dont_test\n\nresult.bytes_per_second";
                var nbb_formatted_code = "# dont_test\n\nresult.bytes_per_second";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Save-Result">Save Result<a class="anchor-link" href="#Save-Result"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">repository</span> <span class="o">=</span> <span class="n">SqliteRepository</span><span class="o">.</span><span class="n">build_repository</span><span class="p">(</span><span class="s2">&quot;results.db&quot;</span><span class="p">)</span>
<span class="n">register_default_tables</span><span class="p">(</span><span class="n">repository</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">repository</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="03132ebc-a39d-4509-9eeb-de74a7790768"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#03132ebc-a39d-4509-9eeb-de74a7790768');

            setTimeout(function() {
                var nbb_cell_id = 7;
                var nbb_unformatted_code = "# dont_test\n\nrepository = SqliteRepository.build_repository(\"results.db\")\nregister_default_tables(repository)\nresults = repository.tables[\"result\"]";
                var nbb_formatted_code = "# dont_test\n\nrepository = SqliteRepository.build_repository(\"results.db\")\nregister_default_tables(repository)\nresults = repository.tables[\"result\"]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result_id</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">add_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result_id</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1
</pre>
</div>
</div>

<div class="output_area">




<div id="8584831c-4fcc-43ac-bdca-5025b2ca44b5"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#8584831c-4fcc-43ac-bdca-5025b2ca44b5');

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "# dont_test\n\nresult_id = results.add_result(result)\nprint(result_id)";
                var nbb_formatted_code = "# dont_test\n\nresult_id = results.add_result(result)\nprint(result_id)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">get_results</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[Result(server=FastAPIUvicornServer(protocol=&#39;http&#39;, name=&#39;fastAPI/uvicorn&#39;, host=&#39;localhost&#39;, port=5001), client=HttpxClient(name=&#39;httpx&#39;), server_details=HostDetails(machine_id=&#39;C07XJ1E5JYVX&#39;, cpuinfo={&#39;python_version&#39;: &#39;3.9.4.final.0 (64 bit)&#39;, &#39;cpuinfo_version&#39;: [8, 0, 0], &#39;cpuinfo_version_string&#39;: &#39;8.0.0&#39;, &#39;arch&#39;: &#39;X86_64&#39;, &#39;bits&#39;: 64, &#39;count&#39;: 6, &#39;arch_string_raw&#39;: &#39;x86_64&#39;, &#39;vendor_id_raw&#39;: &#39;GenuineIntel&#39;, &#39;brand_raw&#39;: &#39;Intel(R) Core(TM) i5-8500B CPU @ 3.00GHz&#39;, &#39;hz_advertised_friendly&#39;: &#39;3.0000 GHz&#39;, &#39;hz_actual_friendly&#39;: &#39;3.0000 GHz&#39;, &#39;hz_advertised&#39;: [3000000000, 0], &#39;hz_actual&#39;: [3000000000, 0], &#39;l2_cache_size&#39;: 262144, &#39;stepping&#39;: 10, &#39;model&#39;: 158, &#39;family&#39;: 6, &#39;flags&#39;: [&#39;1gbpage&#39;, &#39;3dnowprefetch&#39;, &#39;abm&#39;, &#39;acpi&#39;, &#39;adx&#39;, &#39;aes&#39;, &#39;apic&#39;, &#39;avx&#39;, &#39;avx1.0&#39;, &#39;avx2&#39;, &#39;bmi1&#39;, &#39;bmi2&#39;, &#39;clflush&#39;, &#39;clflushopt&#39;, &#39;clfsh&#39;, &#39;clfsopt&#39;, &#39;cmov&#39;, &#39;cx16&#39;, &#39;cx8&#39;, &#39;de&#39;, &#39;ds&#39;, &#39;ds_cpl&#39;, &#39;dscpl&#39;, &#39;dtes64&#39;, &#39;dts&#39;, &#39;em64t&#39;, &#39;erms&#39;, &#39;est&#39;, &#39;f16c&#39;, &#39;fma&#39;, &#39;fpu&#39;, &#39;fpu_csds&#39;, &#39;fxsr&#39;, &#39;hle&#39;, &#39;ht&#39;, &#39;htt&#39;, &#39;ibrs&#39;, &#39;intel_pt&#39;, &#39;invpcid&#39;, &#39;ipt&#39;, &#39;l1df&#39;, &#39;lahf&#39;, &#39;lahf_lm&#39;, &#39;lzcnt&#39;, &#39;mca&#39;, &#39;mce&#39;, &#39;mdclear&#39;, &#39;mmx&#39;, &#39;mon&#39;, &#39;monitor&#39;, &#39;movbe&#39;, &#39;mpx&#39;, &#39;msr&#39;, &#39;mtrr&#39;, &#39;osxsave&#39;, &#39;pae&#39;, &#39;pat&#39;, &#39;pbe&#39;, &#39;pcid&#39;, &#39;pclmulqdq&#39;, &#39;pdcm&#39;, &#39;pge&#39;, &#39;pni&#39;, &#39;popcnt&#39;, &#39;prefetchw&#39;, &#39;pse&#39;, &#39;pse36&#39;, &#39;rdrand&#39;, &#39;rdrnd&#39;, &#39;rdseed&#39;, &#39;rdtscp&#39;, &#39;rdwrfsgs&#39;, &#39;rtm&#39;, &#39;seglim64&#39;, &#39;sep&#39;, &#39;sgx&#39;, &#39;sgx_lc&#39;, &#39;sgxlc&#39;, &#39;smap&#39;, &#39;smep&#39;, &#39;smx&#39;, &#39;ss&#39;, &#39;ssbd&#39;, &#39;sse&#39;, &#39;sse2&#39;, &#39;sse3&#39;, &#39;sse4.1&#39;, &#39;sse4.2&#39;, &#39;sse4_1&#39;, &#39;sse4_2&#39;, &#39;ssse3&#39;, &#39;stibp&#39;, &#39;syscall&#39;, &#39;tm&#39;, &#39;tm2&#39;, &#39;tpr&#39;, &#39;tsc&#39;, &#39;tsc_thread_offset&#39;, &#39;tscdeadline&#39;, &#39;tsci&#39;, &#39;tsctmr&#39;, &#39;tsxfa&#39;, &#39;vme&#39;, &#39;vmx&#39;, &#39;x2apic&#39;, &#39;xd&#39;, &#39;xsave&#39;, &#39;xtpr&#39;], &#39;l2_cache_line_size&#39;: 256, &#39;l2_cache_associativity&#39;: 6}), client_details=HostDetails(machine_id=&#39;C02DR0MZQ6LT&#39;, cpuinfo={&#39;python_version&#39;: &#39;3.9.4.final.0 (64 bit)&#39;, &#39;cpuinfo_version&#39;: [7, 0, 0], &#39;cpuinfo_version_string&#39;: &#39;7.0.0&#39;, &#39;arch&#39;: &#39;X86_64&#39;, &#39;bits&#39;: 64, &#39;count&#39;: 8, &#39;arch_string_raw&#39;: &#39;x86_64&#39;, &#39;vendor_id_raw&#39;: &#39;GenuineIntel&#39;, &#39;brand_raw&#39;: &#39;VirtualApple @ 2.50GHz&#39;, &#39;hz_advertised_friendly&#39;: &#39;2.5000 GHz&#39;, &#39;hz_actual_friendly&#39;: &#39;1.0050 GHz&#39;, &#39;hz_advertised&#39;: [2500000000, 0], &#39;hz_actual&#39;: [1005035792, 0], &#39;l2_cache_size&#39;: 65536, &#39;l2_cache_line_size&#39;: 8192, &#39;l2_cache_associativity&#39;: 8, &#39;model&#39;: 44, &#39;family&#39;: 6, &#39;flags&#39;: [&#39;aes&#39;, &#39;apic&#39;, &#39;clflush&#39;, &#39;cmov&#39;, &#39;cx16&#39;, &#39;cx8&#39;, &#39;de&#39;, &#39;dtes64&#39;, &#39;fpu&#39;, &#39;fxsr&#39;, &#39;lahf_lm&#39;, &#39;mmx&#39;, &#39;monitor&#39;, &#39;pat&#39;, &#39;pclmulqdq&#39;, &#39;pni&#39;, &#39;popcnt&#39;, &#39;pse36&#39;, &#39;sep&#39;, &#39;ss&#39;, &#39;sse&#39;, &#39;sse2&#39;, &#39;sse4_1&#39;, &#39;sse4_2&#39;, &#39;ssse3&#39;, &#39;tsc&#39;]}), file_size=10000000, elapsed=3.1393565829999996, complete_size=375000000)]</pre>
</div>

</div>

<div class="output_area">




<div id="3f269247-a66a-4786-8e08-a5bbaba07897"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#3f269247-a66a-4786-8e08-a5bbaba07897');

            setTimeout(function() {
                var nbb_cell_id = 9;
                var nbb_unformatted_code = "# dont_test\n\nresults.get_results()";
                var nbb_formatted_code = "# dont_test\n\nresults.get_results()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">dict_for_pandas</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">get_results</span><span class="p">()])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>server</th>
      <th>client</th>
      <th>server_host</th>
      <th>client_host</th>
      <th>elapsed</th>
      <th>file_size</th>
      <th>file_size_h</th>
      <th>complete_size</th>
      <th>bytes_per_second</th>
      <th>bytes_per_second_h</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>fastAPI/uvicorn</td>
      <td>httpx</td>
      <td>C07XJ1E5JYVX</td>
      <td>C02DR0MZQ6LT</td>
      <td>3.139357</td>
      <td>10000000</td>
      <td>9.54MB</td>
      <td>375000000</td>
      <td>1.194512e+08</td>
      <td>113.92MB</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">




<div id="bc51ef06-d6ee-4dcc-a4b8-b14cef446bce"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#bc51ef06-d6ee-4dcc-a4b8-b14cef446bce');

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "# dont_test\n\npd.DataFrame([r.dict_for_pandas() for r in results.get_results()])";
                var nbb_formatted_code = "# dont_test\n\npd.DataFrame([r.dict_for_pandas() for r in results.get_results()])";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

