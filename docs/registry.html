---

title: Model Registry


keywords: fastai
sidebar: home_sidebar



nb_path: "10_registry.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 10_registry.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> nb_black
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="81d54a2e-2e57-4a53-afc4-59882533f1c0"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#81d54a2e-2e57-4a53-afc4-59882533f1c0');

            setTimeout(function() {
                var nbb_cell_id = 1;
                var nbb_unformatted_code = "%load_ext nb_black";
                var nbb_formatted_code = "%load_ext nb_black";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="register_model" class="doc_header"><code>register_model</code><a href="https://github.com/ephes/will_it_saturate/tree/main/will_it_saturate/registry.py#L13" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>register_model</code>(<strong><code>model_class</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_model_from_registry" class="doc_header"><code>get_model_from_registry</code><a href="https://github.com/ephes/will_it_saturate/tree/main/will_it_saturate/registry.py#L19" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_model_from_registry</code>(<strong><code>class_name</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@register_model</span>
<span class="k">class</span> <span class="nc">StubServer</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;stub server&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="80765006-0133-4324-97d3-a808134eea97"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#80765006-0133-4324-97d3-a808134eea97');

            setTimeout(function() {
                var nbb_cell_id = 4;
                var nbb_unformatted_code = "@register_model\nclass StubServer(BaseModel):\n    name: str = \"stub server\"";
                var nbb_formatted_code = "@register_model\nclass StubServer(BaseModel):\n    name: str = \"stub server\"";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Usage">Usage<a class="anchor-link" href="#Usage"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">server</span> <span class="o">=</span> <span class="n">StubServer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;foobar&quot;</span><span class="p">)</span>
<span class="n">server_class</span> <span class="o">=</span> <span class="n">get_model_from_registry</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="c418eae4-b60a-46b4-bbb6-8bf287d4c7b3"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#c418eae4-b60a-46b4-bbb6-8bf287d4c7b3');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "server = StubServer(name=\"foobar\")\nserver_class = get_model_from_registry(server.__class__.__name__)";
                var nbb_formatted_code = "server = StubServer(name=\"foobar\")\nserver_class = get_model_from_registry(server.__class__.__name__)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">StubServer</span> <span class="o">==</span> <span class="n">get_model_from_registry</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="dfc200e2-18aa-4825-94eb-f7b563a72c49"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#dfc200e2-18aa-4825-94eb-f7b563a72c49');

            setTimeout(function() {
                var nbb_cell_id = 6;
                var nbb_unformatted_code = "assert StubServer == get_model_from_registry(str(server.__class__.__name__))";
                var nbb_formatted_code = "assert StubServer == get_model_from_registry(str(server.__class__.__name__))";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">server</span> <span class="o">=</span> <span class="n">StubServer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;foobar&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">get_model_from_registry</span><span class="p">(</span><span class="s2">&quot;StubServer&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">StubServer</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="bade458d-b827-4cf7-b41f-b9995306e97e"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#bade458d-b827-4cf7-b41f-b9995306e97e');

            setTimeout(function() {
                var nbb_cell_id = 7;
                var nbb_unformatted_code = "server = StubServer(name=\"foobar\")\nassert get_model_from_registry(\"StubServer\") == StubServer";
                var nbb_formatted_code = "server = StubServer(name=\"foobar\")\nassert get_model_from_registry(\"StubServer\") == StubServer";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Parameter-Models">Parameter Models<a class="anchor-link" href="#Parameter-Models"> </a></h1><p>They are used to serialize clients and servers from and to plain python dicts which then could be serialized to json. It's not clear which Server should be created when we accept a BaseServer. Therefore we transfer a model_parameter instance and have a lookup table to choose the right model.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ModelParameters" class="doc_header"><code>class</code> <code>ModelParameters</code><a href="https://github.com/ephes/will_it_saturate/tree/main/will_it_saturate/registry.py#L25" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ModelParameters</code>(<strong><code>class_name</code></strong>:<code>str</code>, <strong><code>parameters</code></strong>:<code>dict</code>) :: <code>BaseModel</code></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="ac590029-0c6e-47a5-9a08-340f7b4f8868"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#ac590029-0c6e-47a5-9a08-340f7b4f8868');

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "# export\n\n\nclass ModelParameters(BaseModel):\n    class_name: str\n    parameters: dict\n\n    def to_model(self):\n        return get_model_from_registry(self.class_name)(**self.parameters)";
                var nbb_formatted_code = "# export\n\n\nclass ModelParameters(BaseModel):\n    class_name: str\n    parameters: dict\n\n    def to_model(self):\n        return get_model_from_registry(self.class_name)(**self.parameters)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@register_model</span>
<span class="k">class</span> <span class="nc">StubSerializableServer</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;stub server&quot;</span>

    <span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;class_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">(),</span>
        <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="c3d67aa2-ea59-4c81-afd5-53c705d6e89d"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#c3d67aa2-ea59-4c81-afd5-53c705d6e89d');

            setTimeout(function() {
                var nbb_cell_id = 9;
                var nbb_unformatted_code = "@register_model\nclass StubSerializableServer(BaseModel):\n    name: str = \"stub server\"\n\n    def params(self):\n        return {\n            \"class_name\": self.__class__.__name__,\n            \"parameters\": self.dict(),\n        }";
                var nbb_formatted_code = "@register_model\nclass StubSerializableServer(BaseModel):\n    name: str = \"stub server\"\n\n    def params(self):\n        return {\n            \"class_name\": self.__class__.__name__,\n            \"parameters\": self.dict(),\n        }";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Usage">Usage<a class="anchor-link" href="#Usage"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Some Server&quot;</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">StubSerializableServer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

<span class="n">server_parameters</span> <span class="o">=</span> <span class="n">ModelParameters</span><span class="p">(</span><span class="o">**</span><span class="n">server</span><span class="o">.</span><span class="n">params</span><span class="p">())</span>

<span class="n">server_from_params</span> <span class="o">=</span> <span class="n">server_parameters</span><span class="o">.</span><span class="n">to_model</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="cc4691dc-27ac-4c71-8c03-ed27ecd05ebf"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#cc4691dc-27ac-4c71-8c03-ed27ecd05ebf');

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "# dont_test\n\nname = \"Some Server\"\nserver = StubSerializableServer(name=name)\n\nserver_parameters = ModelParameters(**server.params())\n\nserver_from_params = server_parameters.to_model()";
                var nbb_formatted_code = "# dont_test\n\nname = \"Some Server\"\nserver = StubSerializableServer(name=name)\n\nserver_parameters = ModelParameters(**server.params())\n\nserver_from_params = server_parameters.to_model()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Test Server&quot;</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">StubSerializableServer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

<span class="n">server_parameters</span> <span class="o">=</span> <span class="n">ModelParameters</span><span class="p">(</span><span class="o">**</span><span class="n">server</span><span class="o">.</span><span class="n">params</span><span class="p">())</span>
<span class="n">server_from_params</span> <span class="o">=</span> <span class="n">server_parameters</span><span class="o">.</span><span class="n">to_model</span><span class="p">()</span>

<span class="k">assert</span> <span class="n">server</span> <span class="o">==</span> <span class="n">server_from_params</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="e6c4ac1b-5b65-4ab3-8f6c-af7026072200"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#e6c4ac1b-5b65-4ab3-8f6c-af7026072200');

            setTimeout(function() {
                var nbb_cell_id = 11;
                var nbb_unformatted_code = "name = \"Test Server\"\nserver = StubSerializableServer(name=name)\n\nserver_parameters = ModelParameters(**server.params())\nserver_from_params = server_parameters.to_model()\n\nassert server == server_from_params";
                var nbb_formatted_code = "name = \"Test Server\"\nserver = StubSerializableServer(name=name)\n\nserver_parameters = ModelParameters(**server.params())\nserver_from_params = server_parameters.to_model()\n\nassert server == server_from_params";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Export">Export<a class="anchor-link" href="#Export"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="n">notebook2script</span>

<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 00_host.ipynb.
Converted 01_django_views.ipynb.
Converted 01_fastapi_views.ipynb.
Converted 01_file.ipynb.
Converted 05_epochs.ipynb.
Converted 06_results.ipynb.
Converted 100_benchmark_remote_control_server.ipynb.
Converted 10_registry.ipynb.
Converted 25_core.ipynb.
Converted 27_control_server.ipynb.
Converted 28_control_client.ipynb.
Converted 29_control_cli.ipynb.
Converted 30_servers.ipynb.
Converted 31_local_servers.ipynb.
Converted 32_docker_servers.ipynb.
Converted 40_clients.ipynb.
Converted 41_benchmark_clients.ipynb.
Converted 70_repositories.ipynb.
Converted 71_sqlite_repository.ipynb.
Converted 90_benchmark_without_benchmark.ipynb.
Converted 98_run_benchmark.ipynb.
Converted index.ipynb.
</pre>
</div>
</div>

<div class="output_area">




<div id="3ef3b35e-8495-48b7-aef9-8b1e17e602a1"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#3ef3b35e-8495-48b7-aef9-8b1e17e602a1');

            setTimeout(function() {
                var nbb_cell_id = 15;
                var nbb_unformatted_code = "# dont_test\n\nfrom nbdev.export import notebook2script\n\nnotebook2script()";
                var nbb_formatted_code = "# dont_test\n\nfrom nbdev.export import notebook2script\n\nnotebook2script()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

