---

title: Registry


keywords: fastai
sidebar: home_sidebar



nb_path: "03_registry.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 03_registry.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> nb_black
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="4f715884-fce7-4301-87da-77e44c20282f" class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#4f715884-fce7-4301-87da-77e44c20282f');

            setTimeout(function() {
                var nbb_cell_id = 1;
                var nbb_unformatted_code = "%load_ext nb_black";
                var nbb_formatted_code = "%load_ext nb_black";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="register_model" class="doc_header"><code>register_model</code><a href="https://github.com/ephes/will_it_saturate/tree/main/will_it_saturate/registry.py#L13" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>register_model</code>(<strong><code>model_class</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_model_from_registry" class="doc_header"><code>get_model_from_registry</code><a href="https://github.com/ephes/will_it_saturate/tree/main/will_it_saturate/registry.py#L19" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_model_from_registry</code>(<strong><code>class_name</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@register_model</span>
<span class="k">class</span> <span class="nc">StubServer</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;stub server&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="8de0f172-f822-4a56-92bd-1c6467128fc6" class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#8de0f172-f822-4a56-92bd-1c6467128fc6');

            setTimeout(function() {
                var nbb_cell_id = 4;
                var nbb_unformatted_code = "@register_model\nclass StubServer(BaseModel):\n    name: str = \"stub server\"";
                var nbb_formatted_code = "@register_model\nclass StubServer(BaseModel):\n    name: str = \"stub server\"";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Usage">Usage<a class="anchor-link" href="#Usage"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">server</span> <span class="o">=</span> <span class="n">StubServer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;foobar&quot;</span><span class="p">)</span>
<span class="n">server_class</span> <span class="o">=</span> <span class="n">get_model_from_registry</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="382da112-897e-47b9-aa05-d91059376607" class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#382da112-897e-47b9-aa05-d91059376607');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "server = StubServer(name=\"foobar\")\nserver_class = get_model_from_registry(server.__class__.__name__)";
                var nbb_formatted_code = "server = StubServer(name=\"foobar\")\nserver_class = get_model_from_registry(server.__class__.__name__)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">StubServer</span> <span class="o">==</span> <span class="n">get_model_from_registry</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="8da40d17-49db-4cd6-9c33-b5a20d7433e6" class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#8da40d17-49db-4cd6-9c33-b5a20d7433e6');

            setTimeout(function() {
                var nbb_cell_id = 6;
                var nbb_unformatted_code = "assert StubServer == get_model_from_registry(str(server.__class__.__name__))";
                var nbb_formatted_code = "assert StubServer == get_model_from_registry(str(server.__class__.__name__))";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">server</span> <span class="o">=</span> <span class="n">StubServer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;foobar&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">get_model_from_registry</span><span class="p">(</span><span class="s2">&quot;StubServer&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">StubServer</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="fc9770ed-75ce-4ae2-8dc8-56854bcaa908" class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#fc9770ed-75ce-4ae2-8dc8-56854bcaa908');

            setTimeout(function() {
                var nbb_cell_id = 7;
                var nbb_unformatted_code = "server = StubServer(name=\"foobar\")\nassert get_model_from_registry(\"StubServer\") == StubServer";
                var nbb_formatted_code = "server = StubServer(name=\"foobar\")\nassert get_model_from_registry(\"StubServer\") == StubServer";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Parameter-Models">Parameter Models<a class="anchor-link" href="#Parameter-Models"> </a></h1><p>They are used to serialize clients and servers from and to plain python dicts which then could be serialized to json. It's not clear which Server should be created when we accept a BaseServer. Therefore we transfer a model_parameter instance and have a lookup table to choose the right model.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ModelParameters" class="doc_header"><code>class</code> <code>ModelParameters</code><a href="https://github.com/ephes/will_it_saturate/tree/main/will_it_saturate/registry.py#L25" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ModelParameters</code>(<strong><code>class_name</code></strong>:<code>str</code>, <strong><code>parameters</code></strong>:<code>dict</code>) :: <code>BaseModel</code></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="34b2bcc7-ac50-4055-b0e9-9855c054014b" class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#34b2bcc7-ac50-4055-b0e9-9855c054014b');

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "# export\n\n\nclass ModelParameters(BaseModel):\n    class_name: str\n    parameters: dict\n\n    def to_model(self):\n        return get_model_from_registry(self.class_name)(**self.parameters)";
                var nbb_formatted_code = "# export\n\n\nclass ModelParameters(BaseModel):\n    class_name: str\n    parameters: dict\n\n    def to_model(self):\n        return get_model_from_registry(self.class_name)(**self.parameters)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@register_model</span>
<span class="k">class</span> <span class="nc">StubSerializableServer</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;stub server&quot;</span>

    <span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;class_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">(),</span>
        <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="4d01f9cb-3235-4f54-a940-8220554ebe16" class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#4d01f9cb-3235-4f54-a940-8220554ebe16');

            setTimeout(function() {
                var nbb_cell_id = 9;
                var nbb_unformatted_code = "@register_model\nclass StubSerializableServer(BaseModel):\n    name: str = \"stub server\"\n\n    def params(self):\n        return {\n            \"class_name\": self.__class__.__name__,\n            \"parameters\": self.dict(),\n        }";
                var nbb_formatted_code = "@register_model\nclass StubSerializableServer(BaseModel):\n    name: str = \"stub server\"\n\n    def params(self):\n        return {\n            \"class_name\": self.__class__.__name__,\n            \"parameters\": self.dict(),\n        }";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Usage">Usage<a class="anchor-link" href="#Usage"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Some Server&quot;</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">StubSerializableServer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

<span class="n">server_parameters</span> <span class="o">=</span> <span class="n">ModelParameters</span><span class="p">(</span><span class="o">**</span><span class="n">server</span><span class="o">.</span><span class="n">params</span><span class="p">())</span>

<span class="n">server_from_params</span> <span class="o">=</span> <span class="n">server_parameters</span><span class="o">.</span><span class="n">to_model</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="44800261-248e-4fb5-82e1-749f9f193cad" class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#44800261-248e-4fb5-82e1-749f9f193cad');

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "# dont_test\n\nname = \"Some Server\"\nserver = StubSerializableServer(name=name)\n\nserver_parameters = ModelParameters(**server.params())\n\nserver_from_params = server_parameters.to_model()";
                var nbb_formatted_code = "# dont_test\n\nname = \"Some Server\"\nserver = StubSerializableServer(name=name)\n\nserver_parameters = ModelParameters(**server.params())\n\nserver_from_params = server_parameters.to_model()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Test Server&quot;</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">StubSerializableServer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

<span class="n">server_parameters</span> <span class="o">=</span> <span class="n">ModelParameters</span><span class="p">(</span><span class="o">**</span><span class="n">server</span><span class="o">.</span><span class="n">params</span><span class="p">())</span>
<span class="n">server_from_params</span> <span class="o">=</span> <span class="n">server_parameters</span><span class="o">.</span><span class="n">to_model</span><span class="p">()</span>

<span class="k">assert</span> <span class="n">server</span> <span class="o">==</span> <span class="n">server_from_params</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="0d8f6582-ad5a-4bf0-8be3-97a61460d791" class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#0d8f6582-ad5a-4bf0-8be3-97a61460d791');

            setTimeout(function() {
                var nbb_cell_id = 11;
                var nbb_unformatted_code = "name = \"Test Server\"\nserver = StubSerializableServer(name=name)\n\nserver_parameters = ModelParameters(**server.params())\nserver_from_params = server_parameters.to_model()\n\nassert server == server_from_params";
                var nbb_formatted_code = "name = \"Test Server\"\nserver = StubSerializableServer(name=name)\n\nserver_parameters = ModelParameters(**server.params())\nserver_from_params = server_parameters.to_model()\n\nassert server == server_from_params";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

