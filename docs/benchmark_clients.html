---

title: Caveats


keywords: fastai
sidebar: home_sidebar



nb_path: "03_benchmark_clients.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 03_benchmark_clients.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># set_start_method(&quot;fork&quot;)</span>
<span class="c1"># print(os.environ[&quot;OBJC_DISABLE_INITIALIZE_FORK_SAFETY&quot;])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">byte</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">gigabit</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span>
<span class="n">bandwidth</span> <span class="o">=</span> <span class="n">gigabit</span> <span class="o">/</span> <span class="n">byte</span>

<span class="c1"># file_sizes = [10 ** 7, 10 ** 6]</span>
<span class="n">file_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">5</span><span class="p">]</span>
<span class="c1"># file_sizes = [10 ** 7]</span>

<span class="n">benchmark</span> <span class="o">=</span> <span class="n">Benchmark</span><span class="p">(</span>
    <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">,</span>
    <span class="n">duration</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">file_sizes</span><span class="o">=</span><span class="n">file_sizes</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">benchmark</span><span class="o">.</span><span class="n">create_rows</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="HttpxClient" class="doc_header"><code>class</code> <code>HttpxClient</code><a href="https://github.com/ephes/will_it_saturate/tree/main/will_it_saturate/client.py#L30" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>HttpxClient</code>(<strong><code>name</code></strong>:<code>str</code>=<em><code>'base_client'</code></em>) :: <a href="/will_it_saturate/core.html#BenchmarkClient"><code>BenchmarkClient</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_httpx" class="doc_header"><code>run_httpx</code><a href="https://github.com/ephes/will_it_saturate/tree/main/will_it_saturate/client.py#L61" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_httpx</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-1-dea081cab149&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> 
<span class="ansi-green-intense-fg ansi-bold">      8</span> 
<span class="ansi-green-fg">----&gt; 9</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">class</span> HttpxClient<span class="ansi-blue-fg">(</span>BenchmarkClient<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     10</span>     <span class="ansi-green-fg">async</span> <span class="ansi-green-fg">def</span> measure_server<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> benchmark_row<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span>         print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;measure server&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;BenchmarkClient&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">HttpxClient</span><span class="p">()</span>
<span class="n">elapsed</span><span class="p">,</span> <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">measure_server</span><span class="p">(</span><span class="n">benchmark</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>measure server
http://localhost:8000/data/10000000_3_125000000/0
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ConnectError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpx/_exceptions.py</span> in <span class="ansi-cyan-fg">map_exceptions</span><span class="ansi-blue-fg">(mapping, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    325</span>     <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 326</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">yield</span>
<span class="ansi-green-intense-fg ansi-bold">    327</span>     <span class="ansi-green-fg">except</span> Exception <span class="ansi-green-fg">as</span> exc<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpx/_client.py</span> in <span class="ansi-cyan-fg">_send_single_request</span><span class="ansi-blue-fg">(self, request, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">   1501</span>         <span class="ansi-green-fg">with</span> map_exceptions<span class="ansi-blue-fg">(</span>HTTPCORE_EXC_MAP<span class="ansi-blue-fg">,</span> request<span class="ansi-blue-fg">=</span>request<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1502</span><span class="ansi-red-fg">             (status_code, headers, stream, ext,) = await transport.arequest(
</span><span class="ansi-green-intense-fg ansi-bold">   1503</span>                 request<span class="ansi-blue-fg">.</span>method<span class="ansi-blue-fg">.</span>encode<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpcore/_async/connection_pool.py</span> in <span class="ansi-cyan-fg">arequest</span><span class="ansi-blue-fg">(self, method, url, headers, stream, ext)</span>
<span class="ansi-green-intense-fg ansi-bold">    217</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 218</span><span class="ansi-red-fg">                 response = await connection.arequest(
</span><span class="ansi-green-intense-fg ansi-bold">    219</span>                     method<span class="ansi-blue-fg">,</span> url<span class="ansi-blue-fg">,</span> headers<span class="ansi-blue-fg">=</span>headers<span class="ansi-blue-fg">,</span> stream<span class="ansi-blue-fg">=</span>stream<span class="ansi-blue-fg">,</span> ext<span class="ansi-blue-fg">=</span>ext

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpcore/_async/connection.py</span> in <span class="ansi-cyan-fg">arequest</span><span class="ansi-blue-fg">(self, method, url, headers, stream, ext)</span>
<span class="ansi-green-intense-fg ansi-bold">     92</span>                     )
<span class="ansi-green-fg">---&gt; 93</span><span class="ansi-red-fg">                     </span>self<span class="ansi-blue-fg">.</span>socket <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">await</span> self<span class="ansi-blue-fg">.</span>_open_socket<span class="ansi-blue-fg">(</span>timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     94</span>                 self<span class="ansi-blue-fg">.</span>_create_connection<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>socket<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpcore/_async/connection.py</span> in <span class="ansi-cyan-fg">_open_socket</span><span class="ansi-blue-fg">(self, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    118</span>                 <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>uds <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 119</span><span class="ansi-red-fg">                     return await self.backend.open_tcp_stream(
</span><span class="ansi-green-intense-fg ansi-bold">    120</span>                         hostname<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpcore/_backends/auto.py</span> in <span class="ansi-cyan-fg">open_tcp_stream</span><span class="ansi-blue-fg">(self, hostname, port, ssl_context, timeout, local_address)</span>
<span class="ansi-green-intense-fg ansi-bold">     43</span>     ) -&gt; AsyncSocketStream:
<span class="ansi-green-fg">---&gt; 44</span><span class="ansi-red-fg">         return await self.backend.open_tcp_stream(
</span><span class="ansi-green-intense-fg ansi-bold">     45</span>             hostname<span class="ansi-blue-fg">,</span> port<span class="ansi-blue-fg">,</span> ssl_context<span class="ansi-blue-fg">,</span> timeout<span class="ansi-blue-fg">,</span> local_address<span class="ansi-blue-fg">=</span>local_address

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpcore/_backends/asyncio.py</span> in <span class="ansi-cyan-fg">open_tcp_stream</span><span class="ansi-blue-fg">(self, hostname, port, ssl_context, timeout, local_address)</span>
<span class="ansi-green-intense-fg ansi-bold">    269</span>             )
<span class="ansi-green-fg">--&gt; 270</span><span class="ansi-red-fg">             return SocketStream(
</span><span class="ansi-green-intense-fg ansi-bold">    271</span>                 stream_reader<span class="ansi-blue-fg">=</span>stream_reader<span class="ansi-blue-fg">,</span> stream_writer<span class="ansi-blue-fg">=</span>stream_writer

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/Python.framework/Versions/3.9/lib/python3.9/contextlib.py</span> in <span class="ansi-cyan-fg">__exit__</span><span class="ansi-blue-fg">(self, type, value, traceback)</span>
<span class="ansi-green-intense-fg ansi-bold">    134</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 135</span><span class="ansi-red-fg">                 </span>self<span class="ansi-blue-fg">.</span>gen<span class="ansi-blue-fg">.</span>throw<span class="ansi-blue-fg">(</span>type<span class="ansi-blue-fg">,</span> value<span class="ansi-blue-fg">,</span> traceback<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    136</span>             <span class="ansi-green-fg">except</span> StopIteration <span class="ansi-green-fg">as</span> exc<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpcore/_exceptions.py</span> in <span class="ansi-cyan-fg">map_exceptions</span><span class="ansi-blue-fg">(map)</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span>             <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>exc<span class="ansi-blue-fg">,</span> from_exc<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 12</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">raise</span> to_exc<span class="ansi-blue-fg">(</span>exc<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">     13</span>         <span class="ansi-green-fg">raise</span>

<span class="ansi-red-fg">ConnectError</span>: Multiple exceptions: [Errno 61] Connect call failed (&#39;::1&#39;, 8000, 0, 0), [Errno 61] Connect call failed (&#39;127.0.0.1&#39;, 8000)

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">ConnectError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-5-98d2cba3258c&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> 
<span class="ansi-green-intense-fg ansi-bold">      3</span> client <span class="ansi-blue-fg">=</span> HttpxClient<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 4</span><span class="ansi-red-fg"> </span>elapsed<span class="ansi-blue-fg">,</span> responses <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">await</span> client<span class="ansi-blue-fg">.</span>measure_server<span class="ansi-blue-fg">(</span>benchmark<span class="ansi-blue-fg">.</span>rows<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> print<span class="ansi-blue-fg">(</span>elapsed<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-4-553669203778&gt;</span> in <span class="ansi-cyan-fg">measure_server</span><span class="ansi-blue-fg">(self, benchmark_row)</span>
<span class="ansi-green-intense-fg ansi-bold">     18</span>         start <span class="ansi-blue-fg">=</span> time<span class="ansi-blue-fg">.</span>perf_counter<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     19</span>         <span class="ansi-green-fg">async</span> <span class="ansi-green-fg">with</span> httpx<span class="ansi-blue-fg">.</span>AsyncClient<span class="ansi-blue-fg">(</span>limits<span class="ansi-blue-fg">=</span>limits<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> client<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 20</span><span class="ansi-red-fg">             </span>responses <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">await</span> asyncio<span class="ansi-blue-fg">.</span>gather<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span><span class="ansi-blue-fg">[</span>client<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span>url<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> url <span class="ansi-green-fg">in</span> urls<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     21</span>         elapsed <span class="ansi-blue-fg">=</span> time<span class="ansi-blue-fg">.</span>perf_counter<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> start
<span class="ansi-green-intense-fg ansi-bold">     22</span>         print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;done: &#34;</span><span class="ansi-blue-fg">,</span> elapsed<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpx/_client.py</span> in <span class="ansi-cyan-fg">get</span><span class="ansi-blue-fg">(self, url, params, headers, cookies, auth, allow_redirects, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">   1546</span>         <span class="ansi-blue-fg">**</span>Parameters<span class="ansi-blue-fg">**</span><span class="ansi-blue-fg">:</span> See<span class="ansi-red-fg"> </span><span class="ansi-red-fg">`</span>httpx<span class="ansi-blue-fg">.</span>request<span class="ansi-red-fg">`</span><span class="ansi-blue-fg">.</span>
<span class="ansi-green-intense-fg ansi-bold">   1547</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">-&gt; 1548</span><span class="ansi-red-fg">         return await self.request(
</span><span class="ansi-green-intense-fg ansi-bold">   1549</span>             <span class="ansi-blue-fg">&#34;GET&#34;</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   1550</span>             url<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpx/_client.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, content, data, files, json, params, headers, cookies, auth, allow_redirects, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">   1369</span>             cookies<span class="ansi-blue-fg">=</span>cookies<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   1370</span>         )
<span class="ansi-green-fg">-&gt; 1371</span><span class="ansi-red-fg">         response = await self.send(
</span><span class="ansi-green-intense-fg ansi-bold">   1372</span>             request<span class="ansi-blue-fg">,</span> auth<span class="ansi-blue-fg">=</span>auth<span class="ansi-blue-fg">,</span> allow_redirects<span class="ansi-blue-fg">=</span>allow_redirects<span class="ansi-blue-fg">,</span> timeout<span class="ansi-blue-fg">=</span>timeout
<span class="ansi-green-intense-fg ansi-bold">   1373</span>         )

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpx/_client.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, stream, auth, allow_redirects, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">   1404</span>         auth <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_build_request_auth<span class="ansi-blue-fg">(</span>request<span class="ansi-blue-fg">,</span> auth<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1405</span> 
<span class="ansi-green-fg">-&gt; 1406</span><span class="ansi-red-fg">         response = await self._send_handling_auth(
</span><span class="ansi-green-intense-fg ansi-bold">   1407</span>             request<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   1408</span>             auth<span class="ansi-blue-fg">=</span>auth<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpx/_client.py</span> in <span class="ansi-cyan-fg">_send_handling_auth</span><span class="ansi-blue-fg">(self, request, auth, timeout, allow_redirects, history)</span>
<span class="ansi-green-intense-fg ansi-bold">   1442</span> 
<span class="ansi-green-intense-fg ansi-bold">   1443</span>         <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1444</span><span class="ansi-red-fg">             response = await self._send_handling_redirects(
</span><span class="ansi-green-intense-fg ansi-bold">   1445</span>                 request<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   1446</span>                 timeout<span class="ansi-blue-fg">=</span>timeout<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpx/_client.py</span> in <span class="ansi-cyan-fg">_send_handling_redirects</span><span class="ansi-blue-fg">(self, request, timeout, allow_redirects, history)</span>
<span class="ansi-green-intense-fg ansi-bold">   1474</span>                 )
<span class="ansi-green-intense-fg ansi-bold">   1475</span> 
<span class="ansi-green-fg">-&gt; 1476</span><span class="ansi-red-fg">             </span>response <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">await</span> self<span class="ansi-blue-fg">.</span>_send_single_request<span class="ansi-blue-fg">(</span>request<span class="ansi-blue-fg">,</span> timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1477</span>             response<span class="ansi-blue-fg">.</span>history <span class="ansi-blue-fg">=</span> list<span class="ansi-blue-fg">(</span>history<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1478</span> 

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpx/_client.py</span> in <span class="ansi-cyan-fg">_send_single_request</span><span class="ansi-blue-fg">(self, request, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">   1500</span> 
<span class="ansi-green-intense-fg ansi-bold">   1501</span>         <span class="ansi-green-fg">with</span> map_exceptions<span class="ansi-blue-fg">(</span>HTTPCORE_EXC_MAP<span class="ansi-blue-fg">,</span> request<span class="ansi-blue-fg">=</span>request<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1502</span><span class="ansi-red-fg">             (status_code, headers, stream, ext,) = await transport.arequest(
</span><span class="ansi-green-intense-fg ansi-bold">   1503</span>                 request<span class="ansi-blue-fg">.</span>method<span class="ansi-blue-fg">.</span>encode<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   1504</span>                 request<span class="ansi-blue-fg">.</span>url<span class="ansi-blue-fg">.</span>raw<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/Python.framework/Versions/3.9/lib/python3.9/contextlib.py</span> in <span class="ansi-cyan-fg">__exit__</span><span class="ansi-blue-fg">(self, type, value, traceback)</span>
<span class="ansi-green-intense-fg ansi-bold">    133</span>                 value <span class="ansi-blue-fg">=</span> type<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    134</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 135</span><span class="ansi-red-fg">                 </span>self<span class="ansi-blue-fg">.</span>gen<span class="ansi-blue-fg">.</span>throw<span class="ansi-blue-fg">(</span>type<span class="ansi-blue-fg">,</span> value<span class="ansi-blue-fg">,</span> traceback<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    136</span>             <span class="ansi-green-fg">except</span> StopIteration <span class="ansi-green-fg">as</span> exc<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    137</span>                 <span class="ansi-red-fg"># Suppress StopIteration *unless* it&#39;s the same exception that</span>

<span class="ansi-green-fg">~/.pyenv/versions/3.9.2/envs/wis/lib/python3.9/site-packages/httpx/_exceptions.py</span> in <span class="ansi-cyan-fg">map_exceptions</span><span class="ansi-blue-fg">(mapping, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    341</span> 
<span class="ansi-green-intense-fg ansi-bold">    342</span>         message <span class="ansi-blue-fg">=</span> str<span class="ansi-blue-fg">(</span>exc<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 343</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> mapped_exc<span class="ansi-blue-fg">(</span>message<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> exc  <span class="ansi-red-fg"># type: ignore</span>
<span class="ansi-green-intense-fg ansi-bold">    344</span> 
<span class="ansi-green-intense-fg ansi-bold">    345</span> 

<span class="ansi-red-fg">ConnectError</span>: Multiple exceptions: [Errno 61] Connect call failed (&#39;::1&#39;, 8000, 0, 0), [Errno 61] Connect call failed (&#39;127.0.0.1&#39;, 8000)</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="aiohttp">aiohttp<a class="anchor-link" href="#aiohttp"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AioHttpResponse" class="doc_header"><code>class</code> <code>AioHttpResponse</code><a href="https://github.com/ephes/will_it_saturate/tree/main/will_it_saturate/client.py#L84" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AioHttpResponse</code>(<strong><code>url</code></strong>, <strong><code>content</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AioHttpClient" class="doc_header"><code>class</code> <code>AioHttpClient</code><a href="https://github.com/ephes/will_it_saturate/tree/main/will_it_saturate/client.py#L90" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AioHttpClient</code>(<strong><code>name</code></strong>:<code>str</code>=<em><code>'base_client'</code></em>) :: <a href="/will_it_saturate/core.html#BenchmarkClient"><code>BenchmarkClient</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">AioHttpClient</span><span class="p">()</span>
<span class="n">elapsed</span><span class="p">,</span> <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">measure_server</span><span class="p">(</span><span class="n">benchmark</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="wrk">wrk<a class="anchor-link" href="#wrk"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="WrkClient" class="doc_header"><code>class</code> <code>WrkClient</code><a href="https://github.com/ephes/will_it_saturate/tree/main/will_it_saturate/client.py#L121" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>WrkClient</code>(<strong><code>name</code></strong>:<code>str</code>=<em><code>'base_client'</code></em>, <strong><code>connections</code></strong>:<code>int</code>=<em><code>200</code></em>, <strong><code>duration</code></strong>:<code>int</code>=<em><code>20</code></em>, <strong><code>threads</code></strong>:<code>int</code>=<em><code>1</code></em>) :: <a href="/will_it_saturate/core.html#BenchmarkClient"><code>BenchmarkClient</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;capture_output&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;wrk&quot;</span><span class="p">,</span> <span class="s2">&quot;-c20&quot;</span><span class="p">,</span> <span class="s2">&quot;-t1&quot;</span><span class="p">,</span> <span class="s2">&quot;-d2&quot;</span><span class="p">,</span> <span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;wrk.lua&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="c1"># output = subprocess.run([&quot;wrk&quot;, &quot;-d2&quot;, &quot;http://localhost:8000&quot;], **kwargs)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">WrkClient</span><span class="p">()</span>
<span class="n">elapsed</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">benchmark</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Export">Export<a class="anchor-link" href="#Export"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="n">notebook2script</span>

<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 00_core.ipynb.
Converted 01_django_views.ipynb.
Converted 01_fastapi_views.ipynb.
Converted 02_docker_servers.ipynb.
Converted 02_local_servers.ipynb.
Converted 03_benchmark_clients.ipynb.
Converted 04_persistence.ipynb.
Converted 05_run_benchmark.ipynb.
Converted index.ipynb.
</pre>
</div>
</div>

<div class="output_area">




<div id="f07da0a1-09bb-43c5-b805-d7cdc1e67a19"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#f07da0a1-09bb-43c5-b805-d7cdc1e67a19');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "# dont_test\n\nfrom nbdev.export import notebook2script\n\nnotebook2script()";
                var nbb_formatted_code = "# dont_test\n\nfrom nbdev.export import notebook2script\n\nnotebook2script()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

